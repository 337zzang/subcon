# π¨ νƒμ¤ν¬ μ„¤κ³„μ„ (PyQt6 κΈ°λ° μ¬μ„¤κ³„)

## π“‹ κΈ°λ³Έ μ •λ³΄
- **ν”„λ΅μ νΈ**: subcon
- **ν”λ**: λ§¤μ…λ€μ‚¬ μ‹μ¤ν… UI μ ν’ν™”
- **νƒμ¤ν¬ λ²νΈ**: 01
- **νƒμ¤ν¬ ID**: 371dd546-75a0-4f21-b2c5-00f6e7307c16
- **νƒμ¤ν¬λ…**: λ…ΈνΈλ¶ νμΌ λ¶„μ„ λ° μ”κµ¬μ‚¬ν•­ μ •λ¦¬
- **μ‘μ„±μΌ**: 2025-07-14
- **μ‘μ„±μ**: AI Assistant
- **λ¬Έμ„ κ²½λ΅**: C:\Users\Administrator\Desktop\subcon\docs\design\purchase_reconciliation_ui_task01_notebook_analysis_design_20250714.md

## π― μ„¤κ³„ λ©μ  (μ¬μ„¤κ³„)
### μ”κµ¬μ‚¬ν•­
- κΈ°μ΅΄ PyQt6 UIμ™€ λ§¤μ…λ€μ‚¬2.ipynb λ΅μ§ ν†µν•©
- 6κ° Excel νμΌ μ²λ¦¬ (ν„μ¬ 4κ° β†’ 6κ°λ΅ ν™•μ¥)
- λ…ΈνΈλ¶μ λ€μ‚¬ λ΅μ§ μ μ© (κΈμ•΅λ€μ‚¬, μμ°¨λ€μ‚¬, λ¶€λ¶„λ€μ‚¬)
- μ„Έλ΅ λ°©ν–¥ νμΌ μ—…λ΅λ“ UI μ μ§€

### AIμ μ΄ν•΄
ν„μ¬ PyQt6λ΅ κµ¬ν„λ UIλ” λ‹¨μ λ§¤μΉ­λ§ ν•κ³  μμΌλ‚, λ§¤μ…λ€μ‚¬2.ipynbμ λ³µμ΅ν• λ€μ‚¬ λ΅μ§μ„ ν†µν•©ν•μ—¬ μ‹¤μ  μ—…λ¬΄μ— μ‚¬μ©ν•  μ μλ” μ‹μ¤ν…μΌλ΅ κ°μ„ ν•΄μ•Ό ν•©λ‹λ‹¤.

## π” ν„μ¬ μ‹μ¤ν…κ³Ό λ…ΈνΈλ¶ μ°¨μ΄μ  λ¶„μ„

### 1. νμΌ κµ¬μ΅° μ°¨μ΄
| ν•­λ© | ν„μ¬ PyQt6 μ‹μ¤ν… | λ§¤μ…λ€μ‚¬2.ipynb |
|------|-------------------|-----------------|
| νμΌ μ | 4κ° | 6κ° |
| κµ¬μ΅° | supplier, purchase, payment, tax_invoice | ν‘λ ¥μ‚¬λ‹¨ν’λ³„λ§¤μ…, κΈ°μ¤€, λ§¤μ…μ„ΈκΈκ³„μ‚°μ„ λ“± |
| μ²λ¦¬ λ°©μ‹ | λ‹¨μ λ§¤μΉ­ | λ³µμ΅ν• λ€μ‚¬ λ΅μ§ |

### 2. λ€μ‚¬ λ΅μ§ μ°¨μ΄
```python
# ν„μ¬ μ‹μ¤ν…: λ‹¨μ λ§¤μΉ­
if payment.supplier_id == purchase.supplier_id:
    match_result['payment'] = payment

# λ…ΈνΈλ¶: λ³µμ΅ν• λ€μ‚¬
1. κΈμ•΅λ€μ‚¬ (1:1 μ •ν™•ν• λ§¤μΉ­)
2. κΈμ•΅λ€μ‚¬(μκΈ°ν™•μΈ) (λ©΄κ³Όμ„Έ μ΅°κ±΄ μ μ™Έ)
3. μμ°¨λ€μ‚¬ (1:N λ„μ  λ§¤μΉ­)
4. λ¶€λ¶„λ€μ‚¬ (κΈμ•΅μ΄ λ” ν° κ²½μ°)
5. μκΈ°ν™•μΈ (λ³µμ ν•©μ‚°)
```

## π’΅ μ¬μ„¤κ³„ λ°©ν–¥

### 1. UI κ°μ„  μ‚¬ν•­
```python
# FileUploadWidget μμ •
self.file_widgets = {
    'purchase_detail': FileUploadWidget('purchase_detail', 'ν‘λ ¥μ‚¬λ‹¨ν’λ³„λ§¤μ…(μµμΆ…μ‘μ—…μ©)'),
    'standard': FileUploadWidget('standard', 'κΈ°μ¤€(μµμΆ…μ‘μ—…μ©)'),
    'tax_invoice': FileUploadWidget('tax_invoice', 'λ§¤μ…μ„ΈκΈκ³„μ‚°μ„'),
    'payment_book': FileUploadWidget('payment_book', 'μ§€λ¶λ³΄μ΅°μ¥'),
    'tax_invoice_wis': FileUploadWidget('tax_invoice_wis', 'λ§¤μ…μ„ΈκΈκ³„μ‚°μ„(WIS)'),
    'processing_fee': FileUploadWidget('processing_fee', 'μ„κ°€κ³µλΉ„')
}
```

### 2. λ°μ΄ν„° λ¨λΈ μ¬μ„¤κ³„
```python
# ν„μ¬ λ¨λΈ λ€μ‹  λ…ΈνΈλ¶ κµ¬μ΅° λ°μ
class PurchaseDetail:
    """ν‘λ ¥μ‚¬λ‹¨ν’λ³„ λ§¤μ… λ°μ΄ν„°"""
    def __init__(self):
        self.λ…„μ›” = None
        self.ν‘λ ¥μ‚¬μ½”λ“ = None
        self.ν‘λ ¥μ‚¬λ… = None
        self.λ‹¨ν’μ½”λ“ = None
        self.λ‹¨ν’λ… = None
        self.λ©΄κ³Όμ„Έκµ¬λ¶„λ… = None
        self.μµμΆ…λ§¤μ…κΈμ•΅ = None

class TaxInvoiceWIS:
    """λ§¤μ…μ„ΈκΈκ³„μ‚°μ„(WIS) λ°μ΄ν„°"""
    def __init__(self):
        self.ν‘λ ¥μ‚¬μ½”λ“ = None
        self.κ³„μ‚°μ„μ‘μ„±μΌ = None
        self.κ³µκΈ‰κ°€μ•΅ = None
        self.μ„Έμ•΅ = None
        self.κµ­μ„Έμ²­μΉμΈλ²νΈ = None
```

### 3. λ€μ‚¬ λ΅μ§ ν†µν•©
```python
class ReconciliationService:
    def process_all_reconciliation(self):
        # Step A: κΈμ•΅λ€μ‚¬ (1:1 λ€μ‚¬)
        self._process_exact_matching()
        
        # Step A-2: κΈμ•΅λ€μ‚¬(μκΈ°ν™•μΈ)
        self._process_exact_matching_manual()
        
        # Step B: μμ°¨λ€μ‚¬ (1:N λ€μ‚¬)
        self._process_sequential_matching()
        
        # Step C: λ¶€λ¶„λ€μ‚¬
        self._process_partial_matching()
        
        # Step D: λ¶€λ¶„λ€μ‚¬(μκΈ°ν™•μΈ)
        self._process_partial_matching_manual()
```

### 4. Excel μ²λ¦¬ κ°μ„ 
```python
def save_excel_with_pywin(save_path):
    """λ…ΈνΈλ¶κ³Ό λ™μΌν• 5κ° μ‹νΈ μƒμ„±"""
    sheets_data = [
        ("μµμΆ…μ΄κ΄„μ¥λ‚΄μ—­", final_merged_df),
        ("λ€μ‚¬μ΄κ΄„μ¥λ‚΄μ—­", merged_df),
        ("μ§€λ¶λ³΄μ΅°μ¥λ‚΄μ—­", filtered_df_book),
        ("μ„ΈκΈκ³„μ‚°μ„λ‚΄μ—­", df_tax_new),
        ("μ”μ²­λ‹¨ν’λ‚΄μ—­", df_standard)
    ]
```

## β οΈ μ£Όμ” λ³€κ²½μ‚¬ν•­

### 1. FileUploadWidget μμ •
- 6κ° νμΌ νƒ€μ…μΌλ΅ ν™•μ¥
- κ° νμΌλ³„ κ²€μ¦ λ΅μ§ μ¶”κ°€
- λ…„μ›” μλ™ μ¶”μ¶ κΈ°λ¥

### 2. ReconciliationService μ „λ©΄ μ¬μ‘μ„±
- λ…ΈνΈλ¶μ λ€μ‚¬ λ΅μ§ κ·Έλ€λ΅ μ΄μ‹
- find_subset_sum_all_combinations ν•¨μ μ¶”κ°€
- match_tax_and_book ν•¨μ ν†µν•©

### 3. ExcelService κ°μ„ 
- win32com μ‚¬μ©ν•μ—¬ Excel μƒμ„±
- 5κ° μ‹νΈ κµ¬μ΅° μ μ§€
- μ¤νƒ€μΌλ§ μ μ©

### 4. UI νλ¦„ κ°μ„ 
```
1. 6κ° νμΌ μ—…λ΅λ“
2. λ…„μ›” λ²”μ„ μλ™ κ°μ§€
3. λ€μ‚¬ μ‹¤ν–‰ (λ…ΈνΈλ¶ λ΅μ§)
4. 5κ° μ‹νΈ Excel λ‹¤μ΄λ΅λ“
```

## π›΅οΈ λ¦¬μ¤ν¬ κ΄€λ¦¬
| λ¦¬μ¤ν¬ | κ°€λ¥μ„± | μν–¥λ„ | λ€μ‘ λ°©μ• |
|--------|--------|--------|-----------|
| λ€μ‚¬ λ΅μ§ λ³µμ΅λ„ | λ†’μ | λ†’μ | λ…ΈνΈλ¶ μ½”λ“ λ‹¨κ³„λ³„ μ΄μ‹ |
| μ„±λ¥ μ €ν• | μ¤‘κ°„ | μ¤‘κ°„ | QThread ν™μ©, μ§„ν–‰λ¥  ν‘μ‹ |
| λ©”λ¨λ¦¬ μ‚¬μ©λ‰ | μ¤‘κ°„ | λ†’μ | μ²­ν¬ λ‹¨μ„ μ²λ¦¬ |

## π“ μμƒ κ²°κ³Ό
### μ„±κ³µ κΈ°μ¤€
- [x] 6κ° Excel νμΌ μ—…λ΅λ“ μ§€μ›
- [ ] λ…ΈνΈλ¶κ³Ό λ™μΌν• λ€μ‚¬ λ΅μ§
- [ ] λ™μΌν• 5κ° μ‹νΈ Excel μ¶λ ¥
- [ ] λ…„μ›” μλ™ κ°μ§€
- [ ] μ„Έλ΅ λ°©ν–¥ UI μ μ§€

### μμƒ μ†μ” μ‹κ°„
- FileUploadWidget μμ •: 0.5μΌ
- λ€μ‚¬ λ΅μ§ μ΄μ‹: 2μΌ
- Excel μ²λ¦¬ ν†µν•©: 1μΌ
- ν…μ¤νΈ λ° λ””λ²„κΉ…: 1μΌ

## β… κµ¬ν„ κ³„ν

### Phase 1: UI μμ • (0.5μΌ)
1. FileUploadWidget 6κ°λ΅ ν™•μ¥
2. νμΌλ³„ κ²€μ¦ λ΅μ§ μ¶”κ°€
3. λ…„μ›” μ¶”μ¶ κΈ°λ¥ κµ¬ν„

### Phase 2: λ°μ΄ν„° λ¨λΈ (0.5μΌ)
1. λ…ΈνΈλ¶ λ°μ΄ν„° κµ¬μ΅° λ°μ
2. κΈ°μ΅΄ λ¨λΈ λ€μ²΄
3. DataManager μμ •

### Phase 3: λ€μ‚¬ λ΅μ§ (2μΌ)
1. κΈμ•΅λ€μ‚¬ κµ¬ν„
2. μμ°¨λ€μ‚¬ κµ¬ν„
3. λ¶€λ¶„λ€μ‚¬ κµ¬ν„
4. ν…μ¤νΈ λ°μ΄ν„° κ²€μ¦

### Phase 4: Excel μ²λ¦¬ (1μΌ)
1. win32com ν†µν•©
2. 5κ° μ‹νΈ μƒμ„±
3. μ¤νƒ€μΌ μ μ©

### Phase 5: ν†µν•© ν…μ¤νΈ (1μΌ)
1. μ „μ²΄ ν”„λ΅μ„Έμ¤ ν…μ¤νΈ
2. λ…ΈνΈλ¶ κ²°κ³Όμ™€ λΉ„κµ
3. μ„±λ¥ μµμ ν™”

## π“ μ°Έκ³  μλ£
- λ§¤μ…λ€μ‚¬2.ipynb
- κΈ°μ΅΄ PyQt6 μ½”λ“
- pandas/numpy λ¬Έμ„
- win32com Excel κ°€μ΄λ“